---
icon: ri:shield-user-line
---

# Middlewares

Nitro middlewares can hook into the request lifecycle.

::alert{type=primary}
A middleware can modify the request before it is processed, not after.
::

Middlewares are auto-registered within the `middleware/` directory.

```md
routes/
  hello.ts
middleware/
  auth.ts
  logger.ts
  ...
nitro.config.ts
```

## Simple middleware

Middlewares are defined exactly like route handlers.

```ts [middleware/auth.ts]
export default defineEventHandler((event) => {
  // Extends or modify the event
  event.context.user = { name: 'Nitro' }
})
```

::alert
Returning anything from a middleware will close the request.
::

## Execution order

Middlewares are executed in directory listing order.

```md
middleware/
  auth.ts <-- First
  logger.ts <-- Second
  ... <-- Third
```

Prefix middlewares with a number to control their execution order.

```md
middlewares/
  1.logger.ts <-- First
  2.auth.ts <-- Second
  3.... <-- Third
```

Middlewares can be grouped in subdirectories.

```md
middlewares/
  auth/
    index.ts
    ...
  logger/
    index.ts
    ...
```

## Request filtering

Middlewares are executed on every request.
Apply custom logic to scope them to specific conditions.
For example, you can use the URL to apply a middleware to a specific route :

```ts [middlewares/auth.ts]
export default defineEventHandler((event) => {
  // Will only execute for /auth route
  if (getRequestURL(event).startsWith('/auth')) {
    event.context.user = { name: 'Nitro' }
  }
})
```
